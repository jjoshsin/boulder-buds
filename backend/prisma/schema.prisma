generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  displayName   String
  profilePhoto  String?
  age           String?
  birthday      String?
  city          String?
  state         String?
  climbingLevel String?
  climbingType  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  following       Follow[]         @relation("UserFollowing")
  followers       Follow[]         @relation("UserFollowers")
  reviews         Review[]
  communityPhotos CommunityPhoto[]
  reviewLikes     ReviewLike[]

  @@map("users")
}

model Review {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  gymId          String
  gym            Gym      @relation(fields: [gymId], references: [id], onDelete: Cascade)
  overallRating  Float
  settingQuality Float?
  difficulty     Float?
  variety        Float?
  crowding       Float?
  cleanliness    Float?
  vibe           Float?
  reviewText     String?
  tags           String[]
  photos         String[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  likes          ReviewLike[]

  @@unique([userId, gymId])
  @@map("reviews")
}

model CommunityPhoto {
  id        String   @id @default(uuid())
  url       String
  gymId     String
  gym       Gym      @relation(fields: [gymId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  caption   String?
  createdAt DateTime @default(now())

  @@map("community_photos")
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())

  follower  User @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follows")
}

model ReviewLike {
  id        String   @id @default(uuid())
  reviewId  String
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([reviewId, userId])
  @@map("review_likes")
}

model Gym {
  id             String   @id @default(uuid())
  name           String
  address        String
  city           String
  state          String
  latitude       Float
  longitude      Float
  officialPhotos String[]
  amenities      String[]
  priceRange     Int
  climbingTypes  String[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  reviews        Review[]
  communityPhotos CommunityPhoto[]

  @@map("gyms")
}